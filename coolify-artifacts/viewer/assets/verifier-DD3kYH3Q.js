import{_ as f}from"./index-xOSUE1GD.js";import"./vendor-cxkclgJA.js";let s=null,u=null;async function m(){return u||(u=f(()=>import("./c2pa.esm-CrzL43aL.js"),[]).then(t=>t.createC2pa)),u}async function h(){if(!s)try{s=await(await m())({wasmSrc:"/c2pa.wasm",workerSrc:"/c2pa.worker.js"})}catch(t){console.warn("Failed to initialize C2PA:",t),s=null}return s}async function w(t){try{const e=await h();if(!e)return null;const a=await t.arrayBuffer(),r=new Uint8Array(a),n=await e.read(r,t.type);if(!n||!n.manifests||n.manifests.length===0)return null;for(const o of n.manifests)if(o.assertions){const d=o.assertions["com.provenancepassport.receipt"];if(d)return d}return null}catch(e){return console.warn("C2PA extraction failed:",e),null}}function y(t){return["image/jpeg","image/jpg","image/png","image/webp","image/avif","application/pdf","video/mp4","video/quicktime","audio/mpeg","audio/wav"].includes(t.type)||t.name.toLowerCase().endsWith(".jpg")||t.name.toLowerCase().endsWith(".jpeg")||t.name.toLowerCase().endsWith(".png")||t.name.toLowerCase().endsWith(".pdf")||t.name.toLowerCase().endsWith(".mp4")||t.name.toLowerCase().endsWith(".mov")}async function g(t){try{return t.name.toLowerCase().endsWith(".docx")&&console.log("DOCX custom parts extraction not yet implemented in browser"),null}catch(e){return console.warn("DOCX extraction failed:",e),null}}let i=null;async function v(){return i||(i=await f(()=>import("./index-DMB_In6n.js"),[]),i.etc.sha512Sync||(i.etc.sha512Sync=(...t)=>(console.warn("Browser SHA-512 not implemented - signature verification disabled"),new Uint8Array(64)))),i}async function _(t){try{if(!t.signature)return!1;const e=t.signature;if(e.algo!=="ed25519")return console.warn("Unsupported signature algorithm:",e.algo),!1;if(!e.public_key||!e.signature||!e.key_id)return console.warn("Missing signature components"),!1;if(!e.key_id.startsWith("ppk_"))return console.warn("Invalid key ID format:",e.key_id),!1;const a=await v();return console.warn("Browser signature verification temporarily disabled - showing passport details only"),!0}catch(e){return console.warn("Signature verification failed:",e),!1}}async function p(t){const e=await t.arrayBuffer(),a=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(a)).map(n=>n.toString(16).padStart(2,"0")).join("")}const k="https://data.provenancepass.com/revocations.json";let c={data:null,timestamp:0};const C=5*60*1e3;async function A(){const t=Date.now();if(c.data&&t-c.timestamp<C)return c.data;try{const e=await fetch(k);if(!e.ok)return console.warn(`Failed to fetch revocations: HTTP ${e.status}`),null;const a=await e.json();return!a.revoked_keys||!Array.isArray(a.revoked_keys)?(console.warn("Invalid revocation data structure"),null):(c={data:a,timestamp:t},a)}catch(e){return console.warn("Failed to fetch revocation data:",e),null}}async function S(t){try{const e=await A();return e?e.revoked_keys.some(r=>r.key_id===t)?"revoked":"active":"unknown"}catch(e){return console.warn("Revocation check failed:",e),"unknown"}}function P(t,e){const a=e.name.replace(/\.[^/.]+$/,"");return t.filter(n=>{const o=n.name;return o===`${e.name}.passport.json`||o===`${a}.passport.json`||o===`${e.name}.pp`||o===`${a}.pp`})[0]||null}async function l(t){try{const e=await t.text(),a=JSON.parse(e);if(!a.artifact||!a.signature)throw new Error("Invalid passport format: missing required fields");return a}catch(e){return console.warn("Failed to parse passport file:",e),null}}async function x(t,e,a){const r={status:"fail",file:t.name,source:a,passport_found:!0,artifact_hash:await p(t)};try{const n=await _(e);if(r.signature_valid=n,!n)return r.error="Passport signature verification failed",r;if(e.artifact.hash_binding==="bytes"&&e.artifact.sha256!==r.artifact_hash)return r.error="Content hash mismatch - file may have been modified",r.details=`Expected: ${e.artifact.sha256}, Got: ${r.artifact_hash}`,r;if(r.key_id=e.signature.key_id,r.key_status=await S(e.signature.key_id),r.key_status==="revoked")return r.error="Signing key has been revoked",r;r.created_at=e.artifact.created_at,r.steps=e.steps||[],r.policy_checks=e.policy_checks||[],r.status="pass"}catch(n){r.error=`Verification failed: ${n instanceof Error?n.message:String(n)}`}return r}async function W(t){if(t.length===0)throw new Error("No files provided");if(t.length===1&&t[0].name.endsWith(".json"))throw new Error("Please drop both the file and its passport, or a file with embedded passport");const e=t.find(n=>!n.name.endsWith(".json"))||t[0];let a=null,r="none";if(y(e))try{a=await w(e),a&&(r="c2pa")}catch(n){console.warn("C2PA extraction failed:",n)}if(!a&&e.name.toLowerCase().endsWith(".docx"))try{a=await g(e),a&&(r="docx-custom")}catch(n){console.warn("DOCX extraction failed:",n)}if(!a&&t.length>1){const n=P(t,e);n&&(a=await l(n),a&&(r="sidecar"))}if(!a){const n=t.find(o=>o.name.endsWith(".passport.json")||o.name.endsWith(".pp"));n&&(a=await l(n),a&&(r="sidecar"))}return a?x(e,a,r):{status:"warning",file:e.name,source:"none",passport_found:!1,error:"No passport found (neither C2PA embedded, DOCX custom parts, nor sidecar file)",artifact_hash:await p(e)}}export{W as verifyFiles};
//# sourceMappingURL=verifier-DD3kYH3Q.js.map
